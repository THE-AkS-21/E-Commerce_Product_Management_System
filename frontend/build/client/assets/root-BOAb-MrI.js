import{w as x,a as A}from"./with-props-5nfPBK-j.js";import{a as u,p as k,o as e,L as S,S as v,q as j,O as y,s as N}from"./chunk-D4RADZKF-CEFUjEjZ.js";import{a as d,l as n,d as T,r as w}from"./utils-mUqetfhN.js";import{A as P}from"./authContext-DwKCA1uB.js";import{l as E}from"./auth-api-ClrK1Plw.js";const D=s=>{try{const t=s.split(".")[1];return JSON.parse(atob(t))}catch(t){return console.error("Failed to decode token",t),null}},I=({children:s})=>{const[t,r]=u.useState(null),[l,i]=u.useState(null),m=k();u.useEffect(()=>{const o=localStorage.getItem("token");o&&i(o)},[]),u.useEffect(()=>{const o=localStorage.getItem("token"),c=localStorage.getItem("authData");o&&(i(o),d.defaults.headers.Authorization=`Bearer ${o}`,n("AuthProvider",`Token restored: ${o}`)),c?(r(JSON.parse(c)),n("AuthProvider","AuthData restored:",JSON.parse(c))):(delete d.defaults.headers.common.Authorization,r(null),n("AuthProvider","No user session found. Cleared auth data."))},[]);const f={authData:t,token:l,login:async(o,c)=>{n("AuthProvider",`Attempting login for: ${o}`);const g=await E({username:o,password:c}),a=g.token;if(a){localStorage.setItem("token",a),i(a),d.defaults.headers.Authorization=`Bearer ${a}`,n("AuthProvider","Token set after login:",a);const h=D(a),p={id:h.id,username:h.unique_name,role:h.role,token:a};n("AuthProvider","Decoded user data:",p),localStorage.setItem("authData",JSON.stringify(p)),r(p),await T(300)}else console.error("Invalid login response",g)},logout:()=>{n("AuthProvider","Logging out user"),localStorage.removeItem("token"),localStorage.removeItem("authData"),i(null),r(null),d.defaults.headers.Authorization="",m("/")}};return e.jsx(P.Provider,{value:f,children:s})},U=()=>[{rel:"preconnect",href:"https://fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"}];w("Ngo9BigBOggjHTQxAR8/V1NNaF5cWWJCf1FpRmJGdld5fUVHYVZUTXxaS00DNHVRdkdmWXpeeXRTRGNZV0NxXEVWYUA=");function C({children:s}){return e.jsxs("html",{lang:"en",children:[e.jsxs("head",{children:[e.jsx("meta",{charSet:"utf-8"}),e.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),e.jsx(S,{})]}),e.jsxs("body",{children:[s,e.jsx(v,{}),e.jsx(j,{})]})]})}const W=x(function(){return e.jsx(I,{children:e.jsx(y,{})})}),X=A(function({error:t}){let r="Oops!",l="An unexpected error occurred.",i;return N(t)&&(r=t.status===404?"404":"Error",l=t.status===404?"The requested page could not be found.":t.statusText||l),e.jsxs("main",{className:"pt-16 p-4 container mx-auto",children:[e.jsx("h1",{children:r}),e.jsx("p",{children:l}),i]})});export{X as ErrorBoundary,C as Layout,W as default,U as links};
